<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
<meta name="theme-color" content="#000000">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<title>Winning Autumn's Heart üíñ</title>

<style>
:root { --vh: 1vh; }
html, body {
  margin:0; padding:0;
  width:100%; height:100%;
  overflow:hidden; touch-action:none;
  background:black;
}
body { height:calc(var(--vh,1vh)*100); font-family:sans-serif; }

/* START & TUTORIAL */
#startScreen, #tutorialOverlay {
  position:absolute; width:100%; height:calc(var(--vh,1vh)*100);
  display:flex; justify-content:center; align-items:center; flex-direction:column;
  text-align:center;
}
#startScreen {
  background: linear-gradient(45deg,#ffccff,#ccffff,#ffffcc,#ffccff);
  background-size:400% 400%; animation:rainbowShift 8s ease infinite;
  z-index:15;
}
@keyframes rainbowShift {
  0% { background-position:0% 50%; }
  50% { background-position:100% 50%; }
  100% { background-position:0% 50%; }
}
#startScreen h1 { font-size:6vw; margin:0; color:hotpink; text-shadow:2px 2px 6px black; }
#tutorialOverlay { background:rgba(0,0,0,0.75); color:cyan; font-size:4.5vw; padding:15px; z-index:16; display:none; }

/* UI */
button {
  padding:10px 22px;
  font-size:4.5vw;
  border:3px solid hotpink;
  background:black;
  color:hotpink;
  cursor:pointer;
  margin-top:12px;
}

/* GAME AREA */
#gameArea {
  width:100vw; height:calc(var(--vh,1vh)*100);
  background:linear-gradient(to top,#120458,#000);
  position:relative; overflow:hidden;
}
#score {
  position:absolute; top:14px; width:100%;
  color:cyan; font-size:4.5vw; z-index:5; display:none;
}
.heart, .broken {
  position:absolute; font-size:7vw;
}
.heart { color:#ff00ff; }
.broken { color:cyan; }
#basket {
  position:absolute; bottom:15px;
  font-size:7vw; color:cyan;
  display:none;
}

/* LEVEL UP */
#levelUpBanner {
  position:absolute; inset:0;
  display:none; justify-content:center; align-items:center;
  font-size:10vw; font-weight:bold;
  color:hotpink; text-shadow: 3px 3px 10px black;
}

/* VALENTINE SCREEN */
#valentineScreen {
  position:absolute; inset:0;
  background:black; color:hotpink;
  display:none; justify-content:center; align-items:center;
  flex-direction:column; text-align:center;
  font-size:5vw; z-index:20;
}

/* NO COUNTDOWN */
#noCountdown {
  color:white; font-size:5vw;
  text-align:center; margin-top:10px;
  text-shadow:1px 1px 4px black;
}
</style>
</head>

<body>

<!-- AUDIO -->
<audio id="musicPlayer" loop>
  <source src="https://raw.githubusercontent.com/damariet/valentine/main/Chris_Brown_-_New_Flame_Feat._Usher_And_Rick_Ross_(mp3.pm).mp3" type="audio/mpeg">
</audio>
<audio id="catchSound">
  <source src="https://cdn.pixabay.com/download/audio/2022/03/10/audio_6e6f8e3d44.mp3">
</audio>

<!-- SCREENS -->
<div id="startScreen">
  <h1>üíò Winning Autumn‚Äôs Heart üíò</h1>
  <button onclick="showTutorial()">PRESS START</button>
</div>

<div id="tutorialOverlay">
  <div>Drag left or right anywhere to move the basket.</div>
  <button onclick="runDemo()">Got it!</button>
</div>

<div id="score">LEVEL 1 ‚Äî LOVE: 0 / 5</div>
<div id="levelUpBanner"></div>

<div id="gameArea">
  <div id="basket">‚ñÇ‚ñÇ‚ñÇ</div>
</div>

<div id="valentineScreen"></div>

<script>
// ===============================
// DYNAMIC VIEWPORT FIX
function setDvh(){ document.documentElement.style.setProperty('--vh', `${window.innerHeight*0.01}px`); }
window.addEventListener('resize', setDvh); setDvh();

// ===============================
// GAME STATE
let score = 0, level = 1;
let gameLoop, inactivityTimer, isPaused=false, noReturnTimer;

// DOM ELEMENTS
const basket = document.getElementById("basket");
const scoreDisplay = document.getElementById("score");
const levelUpBanner = document.getElementById("levelUpBanner");
const musicPlayer = document.getElementById("musicPlayer");
const catchSound = document.getElementById("catchSound");

// Hide basket until play
basket.style.display = "none";

// ===============================
// START & TUTORIAL
function showTutorial(){
  document.getElementById("startScreen").style.display="none";
  document.getElementById("tutorialOverlay").style.display="flex";
}
function runDemo(){
  document.getElementById("tutorialOverlay").style.display="none";
  let count=0;
  let demo = setInterval(()=>{
    spawnDemoHeart();
    count++;
    if(count>=2){ clearInterval(demo); setTimeout(startGame,500); }
  },1000);
}

// ===============================
// GAME START
function startGame(){
  scoreDisplay.style.display="block";
  basket.style.display="block";
  musicPlayer.play().catch(()=>{});
  updateScore();
  resetInactivity();
  gameLoop = setInterval(createHeart, 600 - level*100);
}

// ===============================
// INACTIVITY
function resetInactivity(){
  clearTimeout(inactivityTimer);
  inactivityTimer = setTimeout(()=>{
    alert("No movement for 20s ‚Äî restarting!");
    resetAll();
  },20000);
}

// ===============================
// SCORE / LEVEL
function updateScore(){
  const targets = [5,10,15];
  scoreDisplay.innerText = `LEVEL ${level} ‚Äî LOVE: ${score} / ${targets[level-1]}`;
}

function showLevelUpBanner(){
  levelUpBanner.innerText = `LEVEL ${level}!`;
  levelUpBanner.style.display = "flex";
  setTimeout(()=>{
    levelUpBanner.style.opacity="0";
    setTimeout(()=>{ levelUpBanner.style.display="none"; levelUpBanner.style.opacity="1"; },800);
  },200);
}

function levelUp(){
  clearInterval(gameLoop);
  if(level < 3){
    level++;
    score = 0;
    showLevelUpBanner();
    setTimeout(()=>{
      updateScore();
      gameLoop=setInterval(createHeart, 600-level*100);
      resetInactivity();
    },1400);
  } else {
    showValentine();
  }
}

// ===============================
// BASKET MOVEMENT
let basketX = window.innerWidth/2;
basket.style.left = basketX+"px";
document.addEventListener("touchmove", e => {
  basketX = e.touches[0].clientX;
  basket.style.left = basketX+"px";
  resetInactivity();
}, {passive:false});

// ===============================
// SPAWN HEARTS
function spawnDemoHeart(){
  let h = document.createElement("div");
  h.innerText="‚ô•"; h.className="heart";
  h.style.left = Math.random()*(window.innerWidth-40)+"px";
  h.style.top = "-40px";
  document.getElementById("gameArea").appendChild(h);

  let fall = setInterval(()=>{
    h.style.top=h.offsetTop+4+"px";
    if(h.offsetTop>window.innerHeight){ clearInterval(fall); h.remove(); }
  },30);
}

function createHeart(){
  if(isPaused) return;
  let h = document.createElement("div");
  let broken = Math.random() < (0.2 + level*0.15);
  h.innerText = broken ? "üíî" : "‚ô•";
  h.className = broken ? "broken" : "heart";
  h.style.left = Math.random()*(window.innerWidth-40)+"px";
  h.style.top = "-40px";
  document.getElementById("gameArea").appendChild(h);

  let fall = setInterval(()=>{
    if(isPaused) return;
    h.style.top=h.offsetTop+(2+level*1.5)+"px";

    let hr=h.getBoundingClientRect();
    let br=basket.getBoundingClientRect();
    // full basket width collision
    if(hr.left<br.right && hr.right>br.left && hr.bottom>=br.top){
      if(broken) score = Math.max(0, score-1);
      else { catchSound.currentTime=0; catchSound.play(); score++; }

      h.remove(); clearInterval(fall);
      updateScore(); resetInactivity();

      const targets=[5,10,15];
      if(score>=targets[level-1]) levelUp();
    }

    if(h.offsetTop>window.innerHeight){ clearInterval(fall); h.remove(); }
  },30);
}

// ===============================
// PAUSE / RESUME
document.getElementById("pauseBtn").onclick=()=>{
  isPaused=true; clearInterval(gameLoop); musicPlayer.pause();
  document.getElementById("pauseBtn").style.display="none";
  document.getElementById("resumeBtn").style.display="inline";
};
document.getElementById("resumeBtn").onclick=()=>{
  isPaused=false; musicPlayer.play();
  document.getElementById("resumeBtn").style.display="none";
  document.getElementById("pauseBtn").style.display="inline";
  gameLoop=setInterval(createHeart,600-level*100);
};

// ===============================
// VALENTINE SCREEN
function showValentine(){
  clearInterval(gameLoop);
  document.getElementById("valentineScreen").innerHTML=`
    <h1>Autumn‚Ä¶ üíò</h1>
    <h2>Will you be my Valentine?</h2>
    <button id="yesBtn">YES</button>
    <button id="noBtn">NO</button>
    <div id="noCountdown"></div>`;
  document.getElementById("valentineScreen").style.display="flex";
  bindValentine();
}

function bindValentine(){
  document.getElementById("yesBtn").onclick=()=>{
    document.getElementById("valentineScreen").innerHTML=`
      <h1>YOU WON MY HEART üíò</h1>
      <h2>Happy Valentine‚Äôs Day! üíò</h2>
      <button onclick="resetAll()">RESTART</button>`;
  };
  const noBtn=document.getElementById("noBtn");
  let noMoves=0;
  noBtn.onmouseover=()=>{
    if(noMoves>=3) return;
    noBtn.style.position="absolute";
    noBtn.style.left=Math.random()*(valentineScreen.offsetWidth-noBtn.offsetWidth)+"px";
    noBtn.style.top=Math.random()*(valentineScreen.offsetHeight-noBtn.offsetHeight)+"px";
    noMoves++;
  };
  noBtn.onclick=startNoCountdown;
}

function startNoCountdown(){
  document.getElementById("valentineScreen").innerHTML=`
    <h1>Oh you thought you could say NO? üòè</h1>
    <div id="noCountdown">Returning in 5</div>`;
  let count=5;
  noReturnTimer=setInterval(()=>{
    count--;
    document.getElementById("noCountdown").innerText=`Returning in ${count}`;
    if(count<=0){
      clearInterval(noReturnTimer);
      showValentine();
    }
  },1000);
}

// ===============================
// RESET GAME
function resetAll(){
  musicPlayer.pause(); musicPlayer.currentTime=0;
  level=1; score=0;
  document.getElementById("controls").style.display="none";
  document.getElementById("valentineScreen").style.display="none";
  basket.style.display="none";
  document.getElementById("startScreen").style.display="flex";
  clearInterval(gameLoop); clearTimeout(inactivityTimer);
  if(noReturnTimer) clearInterval(noReturnTimer);
}
</script>

</body>
</html>







